<link rel="stylesheet" type="text/css" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css">
<link rel="stylesheet" type="text/css" href="https://pixinvent.com/stack-responsive-bootstrap-4-admin-template/app-assets/css/bootstrap-extended.min.css">
<link rel="stylesheet" type="text/css" href="https://pixinvent.com/stack-responsive-bootstrap-4-admin-template/app-assets/fonts/simple-line-icons/style.min.css">
<link rel="stylesheet" type="text/css" href="https://pixinvent.com/stack-responsive-bootstrap-4-admin-template/app-assets/css/colors.min.css">
<link rel="stylesheet" type="text/css" href="https://pixinvent.com/stack-responsive-bootstrap-4-admin-template/app-assets/css/bootstrap.min.css">
<link href="https://fonts.googleapis.com/css?family=Montserrat&display=swap" rel="stylesheet">
<link rel="stylesheet" href="components/pannel/style.css">

<div class="grey-bg container-fluid">
  <section id="minimal-statistics">
    <div class="row">
      <div class="col-12 mt-3 mb-1">
        <h4 class="text-uppercase">Elitmus Game Dashboard</h4>
        <p>Statistics </p>
      </div>
    </div>
    <div class="row">
      <div class="col-xl-3 col-sm-6 col-12"> 
        <div class="card">
          <div class="card-content">
            <div class="card-body">
              <div class="media d-flex">
                <div class="align-self-center">
                  <i class="icon-pencil primary font-large-2 float-left"></i>
                </div>
                <div class="media-body text-right">
                  <h3><%=Ruser.length
                  %></h3>
                  <span>Registered User</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="col-xl-3 col-sm-6 col-12">
        <div class="card">
          <div class="card-content">
            <div class="card-body">
              <div class="media d-flex">
                <div class="align-self-center">
                  <i class="icon-speech warning font-large-2 float-left"></i>
                </div>
                <div class="media-body text-right">
                  <h3><%= user.length%></h3>
                  <span>Active Users</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="col-xl-3 col-sm-6 col-12">
        <div class="card">
          <div class="card-content">
            <div class="card-body">
              <div class="media d-flex">
                <div class="align-self-center">
                  <i class="icon-graph success font-large-2 float-left"></i>
                </div>
                <div class="media-body text-right">
                  <h3><%= (Ruser.length/user.length)*1 %>%</h3>
                  <span>Active Rate</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="col-xl-3 col-sm-6 col-12">
        <div class="card">
          <div class="card-content">
            <div class="card-body">
              <div class="media d-flex">
                <div class="align-self-center">
                  <i class="icon-pointer danger font-large-2 float-left"></i>
                </div>
                <div class="media-body text-right">
                  <h3><%=Ruser.length+user.length+100%></h3>
                  <span>Total Visits</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  
    <!-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ -->
<main class="container" >
  <canvas id="barChart"></canvas>
  <canvas id="lineChart"></canvas>
</main>

    <!-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ -->
    
    
    

   
  
  <section id="stats-subtitle">
  <div class="row">
    <div class="col-12 mt-3 mb-1">
      <h4 class="text-uppercase">Statistics Monthly basis</h4>
      <p>Month basis performance</p>
    </div>
  </div>

  <div class="row">
    <div class="col-xl-6 col-md-12">
      <div class="card overflow-hidden">
        <div class="card-content">
          <div class="card-body cleartfix">
            <div class="media align-items-stretch">
              <div class="align-self-center">
                <i class="icon-pencil primary font-large-2 mr-2"></i>
              </div>
              <div class="media-body">
                <h4>Highest Score</h4>
              </div>
              <div class="align-self-center">
                <h1>
                <span class="max-user"></span>-
                  <span class="max-score"></span>
                  </h1>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="col-xl-6 col-md-12">
      <div class="card">
        <div class="card-content">
          <div class="card-body cleartfix">
            <div class="media align-items-stretch">
              <div class="align-self-center">
                <i class="icon-speech warning font-large-2 mr-2"></i>
              </div>
              <div class="media-body">
                <h4>Lowest Score</h4>
              </div>
              <div class="align-self-center"> 
                <h1 >
                  <span class="min-user"></span>-
                  <span class="min-score"></span>
                </h1>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- <div class="row">
    <div class="col-xl-6 col-md-12">
      <div class="card">
        <div class="card-content">
          <div class="card-body cleartfix">
            <div class="media align-items-stretch">
              <div class="align-self-center">
                <h1 class="mr-2">20</h1>
              </div>
              <div class="media-body">
                <h4>Registered user</h4>
                <span>Monthly(April)</span>
              </div>
              <div class="align-self-center">
                <i class="icon-heart danger font-large-2"></i>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- <div class="col-xl-6 col-md-12">
      <div class="card">
        <div class="card-content">
          <div class="card-body cleartfix">
            <div class="media align-items-stretch">
              <div class="align-self-center">
                <h1 class="mr-2">9</h1>
              </div>
              <div class="media-body">
                <h4>Montly Active</h4>
                <span>April</span>
              </div>
              <div class="align-self-center">
                <i class="icon-wallet success font-large-2"></i>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div> -->
  <!-- </div> -->
</section>
</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.1.4/Chart.min.js"></script>
<script>
  // var ruser =`<%- JSON.stringify(Ruser) %>` ;
  var user =`<%- JSON.stringify(user) %>` ;
  // var russArray = JSON.parse(ruser);
  var scoreArray = JSON.parse(user);
console.log(scoreArray)
  var scores = scoreArray.map( ({score:{game1=[0],game2=[0],game3=[0]}}) => game1[0]  + game2[0]+game3[0]   );
  var usernames = scoreArray.map( ({email}) => email.split('@')[0] );
  var times = scoreArray
  var max = scores.reduce ( (accu,curr) => curr>accu?curr:accu,0);
  var min = scores.reduce ( (accu,curr) => curr<accu?curr:accu);
  document.querySelector('.max-score').textContent=max;
  document.querySelector('.max-user').textContent=usernames[scores.indexOf(max)].toUpperCase();
  document.querySelector('.min-score').textContent=min;
  document.querySelector('.min-user').textContent=usernames[scores.indexOf(min)].toUpperCase();
  var ctx = document.getElementById("barChart").getContext('2d');
var barChart = new Chart(ctx, {
  type: 'bar',
  data: {
    labels: usernames,
    datasets: [{
      label: 'Scores',
      data: scores,
      backgroundColor: "rgba(255,0,0,1)"
    }]
  }
});

var cty = document.getElementById("lineChart").getContext('2d');
var barChart = new Chart(cty, {
  type: 'line',
  data: {
    labels: usernames,
    datasets: [{
      label: 'Time Spent',
      data: scores,
      backgroundColor: 'transparent',
      borderColor:'blue'
    }]
  }
});
</script>